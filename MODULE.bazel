module(
    name = "nativelink",
    version = "0.5.3",
    compatibility_level = 0,
)

bazel_dep(name = "rules_cc", version = "0.0.9")
bazel_dep(name = "platforms", version = "0.0.10")
bazel_dep(name = "rules_python", version = "0.36.0")

python = use_extension("@rules_python//python/extensions:python.bzl", "python")
python.toolchain(
    configure_coverage_tool = True,
    # TODO(aaronmondal): Fix or remove legacy container pipelines so that they
    #                    run rootless.
    ignore_root_user_error = True,
    python_version = "3.12",
)
use_repo(python, python = "python_versions")

bazel_dep(name = "rules_rust", version = "0.51.0")

rust = use_extension("@rules_rust//rust:extensions.bzl", "rust")
rust.toolchain(
    edition = "2021",
    rust_analyzer_version = "nightly/2024-11-22",
    rustfmt_version = "nightly/2024-11-22",
    sha256s = {
        "2024-11-22/rustc-nightly-x86_64-unknown-linux-gnu.tar.xz": "02ef1e3ca25a03ccb9828a4e932b27f59a0625ed9772463d556539da38b7fd7b",
        "2024-11-22/clippy-nightly-x86_64-unknown-linux-gnu.tar.xz": "9f888010e1f01373d401c65ab0adf6f9fc76cbd0034f4346352c1bd211471339",
        "2024-11-22/cargo-nightly-x86_64-unknown-linux-gnu.tar.xz": "19cb321daca3e733a6b0baf06f70112ea037842e2c716d8eebb1791047fa1d88",
        "2024-11-22/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz": "78821b92524e1fb1415e3834f9aa25a4fed98741ab74596a38a5d4be64c5913e",
        "2024-11-22/llvm-tools-nightly-x86_64-unknown-linux-gnu.tar.xz": "8f245a660be95f0b45fb174f0af5f0401a436bf67c332543dfd829db8b9d6f1f",
        "2024-11-22/rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz": "7e74dd19bb929dc7d53dacd595c3dff8d498a3f5485ea7ab057188c9d2f50224",
        "2024-11-22/rustc-nightly-x86_64-apple-darwin.tar.xz": "4dc8409bcf6bda4e2ca28959f998635f03daee08b557decd933ca6a3bbf2fc7a",
        "2024-11-22/clippy-nightly-x86_64-apple-darwin.tar.xz": "72565d3bb2dafc3ff4b64d8ede24a9bce60aad5132f2ff23f00c184edf6135e2",
        "2024-11-22/cargo-nightly-x86_64-apple-darwin.tar.xz": "cd5b238d86d0bbc1355cc1a3e7f43a19dc25eeb85ba7945b8a31b2d5cd6445af",
        "2024-11-22/rustfmt-nightly-x86_64-apple-darwin.tar.xz": "334d25edfd8d71e85cfd9d8a228b5024353098ab922867f2a0e6c97e0ae02ebe",
        "2024-11-22/llvm-tools-nightly-x86_64-apple-darwin.tar.xz": "b95121992c74a171f32bf4b32e820649326e93fde6b6bfc544c7dfa8a572fbb4",
        "2024-11-22/rust-std-nightly-x86_64-apple-darwin.tar.xz": "882e67ad7ad8219728cf7f4a44974553cc5de4c74402988112f1e2823a9ec51d",
        "2024-11-22/rustc-nightly-aarch64-apple-darwin.tar.xz": "d933c768f0a99d18128d1b80de46db73888ce3aca66fcaf4cea812b8708fa8ac",
        "2024-11-22/clippy-nightly-aarch64-apple-darwin.tar.xz": "20c4389efef99caac8cf1982cf91627bdd0a0b5d551235236e416d91cc451efc",
        "2024-11-22/cargo-nightly-aarch64-apple-darwin.tar.xz": "03f4294f71498763980b644548df0671c19df22f0108fdc7297daa8e25a07b54",
        "2024-11-22/rustfmt-nightly-aarch64-apple-darwin.tar.xz": "44556dcda6193e018067ed746b93dccf8aa8e953efd36e0892aa4b41928872d8",
        "2024-11-22/llvm-tools-nightly-aarch64-apple-darwin.tar.xz": "6f79e3ab078e011391e1de06ee757bf4628a9344d59519c879d2a5927f262fd8",
        "2024-11-22/rust-std-nightly-aarch64-apple-darwin.tar.xz": "76f3489b6db7bbce7f264bcab5ffb47ebf508e8d2f4b89945940f1f2de36a11c",
    },
    versions = [
        "1.82.0",
        "nightly/2024-11-22",
    ],
)

rust_host_tools = use_extension(
    "@rules_rust//rust:extension.bzl",
    "rust_host_tools",
)
rust_host_tools.host_tools(
    edition = "2021",
    version = "1.82.0",
)

use_repo(rust, "rust_toolchains")

crate = use_extension("@rules_rust//crate_universe:extension.bzl", "crate")
crate.from_cargo(
    name = "crates",
    cargo_lockfile = "//:Cargo.lock",
    manifests = ["//:Cargo.toml"],
    supported_platform_triples = [
        "aarch64-apple-darwin",
        "aarch64-unknown-linux-gnu",
        "arm-unknown-linux-gnueabi",
        "armv7-unknown-linux-gnueabi",
        "x86_64-apple-darwin",
        "x86_64-pc-windows-msvc",
        "x86_64-unknown-linux-gnu",
    ],
)
use_repo(crate, "crates")

rust_analyzer = use_extension(
    "@rules_rust//tools/rust_analyzer:extension.bzl",
    "rust_analyzer_dependencies",
)
rust_analyzer.rust_analyzer_dependencies()

bazel_dep(name = "protobuf", version = "27.5", repo_name = "com_google_protobuf")
bazel_dep(name = "toolchains_protoc", version = "0.3.3")

protoc = use_extension("@toolchains_protoc//protoc:extensions.bzl", "protoc")
protoc.toolchain(
    google_protobuf = "com_google_protobuf",
    version = "v28.0",
)

# Local remote execution.
bazel_dep(name = "local-remote-execution", version = "0.0.0")
local_path_override(
    module_name = "local-remote-execution",
    path = "local-remote-execution",
)
